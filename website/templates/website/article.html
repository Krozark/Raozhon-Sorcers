{% extends "base.html" %}

{% load comments website_tags humanize %}

{% block app.header %}
{% if object.image %}
<div id="header-img">
    <img src="{{object.image.url}}">
    <div>
        <div>
            <h1>{{object}}</h1>
            <h2><i>{{object.date}}</i> // par {{object.created_by}}</h2>
            <p>Cart√©gorie{{object.M2M_category.count|pluralize }}: {% for category in object.M2M_category.all %}<a href="{{category.get_absolute_url}}">{{category|title}}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock%}

{% block app.content %}
<div class="article">
    <div>
        {{object.content|safe}}
    </div>
</div>

{% comment %}
{% if user.is_authenticated %}
    {% get_comment_form for object as form %}
    <form action="{% comment_form_target %}" method="POST">
    {% csrf_token %}
    {{ form.comment }}
    {{ form.honeypot }}
    {{ form.content_type }}
    {{ form.object_pk }}
    {{ form.timestamp }}
    {{ form.security_hash }}
    <input type="hidden" name="next" value="{{ object.get_absolute_url }}" />
    <input type="submit" value="Add comment" id="id_submit" />
    </form>
{% else %}
{% endcomment %}

{% get_comment_form for object as form %}
<div class="w3-container w3-theme-l2">
    <form action="{% comment_form_target %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ object.get_absolute_url }}" />
        <div class="w3-section">
            <label>Nom</label>
            <input name="name" id="id_name" maxlength="50" required="" type="text">
        </div>
        <div class="w3-section">
            <label>Email</label>
            <input name="email" id="id_email" required="" type="email">
        </div>
        <div class="w3-section">
            <label>Message</label>
            <textarea name="comment" id="id_comment" maxlength="3000" rows="10" cols="40" required=""></textarea>
        </div>
        {{ form.honeypot }}
        {{ form.content_type }}
        {{ form.object_pk }}
        {{ form.timestamp }}
        {{ form.security_hash }}
        <button type="submit" class="w3-button w3-black w3-margin-bottom" value="Post">
            <i class="fa fa-paper-plane w3-margin-right"></i>Envoyer
        </button>
    </form>
</div>
{#% endif %#}

{% get_comment_list for object as comment_list %}
{% for comment in comment_list reversed %}
<div class="comment">
    <br>
    <img src="{% gravatar_url comment.user_email %}" alt="Avatar" onerror="this.src='{{STATIC_URL}}/website/img/default_avatar.jpg'">
    <span>{{comment.submit_date|naturaltime}}</span>
    <h4>
        {{comment.user_name}}
        {% if gravatar_data %}- {{gravatar_data.displayName}} {% endif %}
    </h4>
    <br>
    <hr class="w3-clear">
    <p>{{comment.comment}}</p>
</div>
{% endfor %}
{% endblock %}
